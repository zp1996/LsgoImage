!function(t){var i=function(t){return new i.fn.init(t)};i.fn=i.prototype,i.fn.init=function(t){var i=t.width||0,n=t.height||0;this.n=1,this.startX=0,this.startY=0,this.imgData=null,Object.defineProperties(this,{width:{get:function(){return i},set:function(n){t.width=i=n}},height:{get:function(){return n},set:function(i){t.height=n=i}}}),this.ctx=t.getContext("2d"),this.oldData=[]},i.noop=function(){},i.setImg=function(t,n,a,h){this.startX=a||0,this.startY=h||0,this.width=this.startX+t.width,this.height=this.startX+t.height,this.ctx.drawImage(t,this.startX,this.startY,t.width,t.height),n=n||i.noop,this.getInfo(),n.call(this)},i.fn.init.prototype=i.fn,i.fn.setImg=function(t,n,a,h){if("string"==typeof t){var s=new Image,r=this;s.src=t,s.onload=function(){i.setImg.call(r,this,n,a,h)},s.onerror=function(){alert("图片路径有误！")}}else i.setImg.call(this,t,n,a,h);return this},i.fn.getInfo=function(t){return this.imgData=this.ctx.getImageData(this.startX,this.startY,this.width-this.startX,this.height-this.startY),this.oldData=JSON.parse(JSON.stringify(this.imgData.data)),this},i.fn.matrixSlice=function(t){t=t||5,this.n=t;for(var i,n=this.imgData.data,a=n.length>>2,h=a/t|0,s={},r=0,o=0;o<a;o+=h)i=o+4*h,i=i<a?i:-1,s[r++]=Array.prototype.slice.call(n,o,o+4*h);return s},i.fn.BaseFun=function(t,i){return i=i||this.imgData.data,t.call(this,i),this.ctx.putImageData(this.imgData,0,0),this},i.fn.toGray=function(t){this.BaseFun(function(t){for(var i,n,a,h=t.length,s=0;s<h;s+=4)i=t[s],n=t[s+1],a=t[s+2],t[s]=t[s+1]=t[s+2]=(299*i+587*n+114*a)/1e3|0},t)},i.fn.toInverse=function(t){this.BaseFun(function(t){for(var i=t.length,n=0;n<i;n+=4)t[n]=255-t[n],t[n+1]=255-t[n+1],t[n+2]=255-t[n+2]},t)},i.fn.toOld=function(){this.BaseFun(function(t){for(var i=t.length,n=0;n<i;n+=4)t[n]=this.oldData[n],t[n+1]=this.oldData[n+1],t[n+2]=this.oldData[n+2]})},i.fn.toMosaic=function(t,i){this.BaseFun(function(t){i=i||10;for(var a,s,r,o,e=this.width,f=this.height,u=t.length,c=0;c<e;c+=i)for(var g=0;g<f;g+=i){m=Math.floor(Math.random()*i),n=Math.floor(Math.random()*i),h=g+m>f-1?f-1:g+m,w=c+n>e-1?e-1:c+n,o=e*h*4+4*w,a=t[o],s=t[o+1],r=t[o+2];for(var l=0;l<i;l++)for(var d=0;d<i&&(o=e*(g+l)*4+4*(c+d),!(o>u));d++)t[o]=a,t[o+1]=s,t[o+2]=r}},t)},i.fn.ConBrBaseFilter=function(t,i,n){Array.isArray(t)||(n=i,i=t),this.BaseFun(function(t){if(i||n){for(var a=t.length,h=[0,0,0],s=this.width*this.height,r=0;r<a;r+=4)h[0]+=this.oldData[r],h[1]+=this.oldData[r+1],h[2]+=this.oldData[r+2],t[r]=this.oldData[r],t[r+1]=this.oldData[r+1],t[r+2]=this.oldData[r+2];h=h.map(function(t){return t/s|0});for(var r=0;r<a;r+=4)t[r]-=h[0],t[r+1]-=h[1],t[r+2]-=h[2],t[r]=t[r]*i|0,t[r+1]=t[r+1]*i|0,t[r+2]=t[r+2]*i|0,t[r]+=h[0]*n|0,t[r+1]+=h[1]*n|0,t[r+2]+=h[2]*n|0}})},i.fn.toMirror=function(t){this.BaseFun(function(t){for(var i,n,a,h,s,r,o=(t.length,this.width),e=o/2|0,f=this.height,u=0;u<f;u++){s=u*o*4;for(var c=0;c<e;c++)h=s+4*c,r=s+4*(o-1-c),i=t[h],n=t[h+1],a=t[h+2],t[h]=t[r],t[h+1]=t[r+1],t[h+2]=t[r+2],t[r]=i,t[r+1]=n,t[r+2]=a}},t)},t.I=t.LSGOImage=i}(this);
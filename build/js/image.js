!function(t){function i(t){return t>255?255:t<0?0:t}function a(t,i,n){for(var h={},a=0,r=1.5,s=2*Math.pow(r,2),o=Math.PI*s,e=0;e<n;e++){t[e]=[];for(var f=Math.abs(i-e),u=0;u<n;u++){var c=Math.abs(i-u),g=f+c;t[e][u]=g in h?h[g]:h[g]=Math.exp(-(Math.pow(f,2)+Math.pow(c,2))/s)/o,a+=t[e][u]}}for(var e=0;e<n;e++)for(var u=0;u<n;u++)t[e][u]/=a}var r=function(t){return new r.fn.init(t)};r.fn=r.prototype,r.fn.init=function(t){var i=t.width||0,n=t.height||0;this.n=1,this.startX=0,this.startY=0,this.imgData=null,Object.defineProperties(this,{width:{get:function(){return i},set:function(n){t.width=i=n}},height:{get:function(){return n},set:function(i){t.height=n=i}}}),this.ctx=t.getContext("2d"),this.oldData=[]},r.noop=function(){},r.setImg=function(t,i,n,h){this.startX=n||0,this.startY=h||0,this.width=this.startX+t.width,this.height=this.startX+t.height,this.ctx.drawImage(t,this.startX,this.startY,t.width,t.height),i=i||r.noop,this.getInfo(),i.call(this)},r.fn.init.prototype=r.fn,r.fn.setImg=function(t,i,n,h){if("string"==typeof t){var a=new Image,s=this;a.src=t,a.onload=function(){r.setImg.call(s,this,i,n,h)},a.onerror=function(){alert("图片路径有误！")}}else r.setImg.call(this,t,i,n,h);return this},r.fn.getInfo=function(t){this.imgData=this.ctx.getImageData(this.startX,this.startY,this.width-this.startX,this.height-this.startY),this.oldData=[];for(var i=0;i<this.height;i++){var n=i*this.width*4;this.oldData[i]=this.imgData.data.slice(n,n+4*this.width)}return this},r.fn.matrixSlice=function(t){t=t||5,this.n=t;for(var i,n=this.imgData.data,h=n.length>>2,a=h/t|0,r={},s=0,o=0;o<h;o+=a)i=o+4*a,i=i<h?i:-1,r[s++]=Array.prototype.slice.call(n,o,o+4*a);return r},r.fn.BaseFun=function(t,i){return i=i||this.imgData.data,t.call(this,i),this.ctx.putImageData(this.imgData,0,0),this},r.fn.toGray=function(t){this.BaseFun(function(t){for(var i,n,h,a=t.length,r=0;r<a;r+=4)i=t[r],n=t[r+1],h=t[r+2],t[r]=t[r+1]=t[r+2]=(299*i+587*n+114*h)/1e3|0},t)},r.fn.toInverse=function(t){this.BaseFun(function(t){for(var i=t.length,n=0;n<i;n+=4)t[n]=255-t[n],t[n+1]=255-t[n+1],t[n+2]=255-t[n+2]},t)},r.fn.toOld=function(){this.BaseFun(function(t){for(var i,n=t.length,h=4*this.width,a=0;a<n;a+=4)i=a/h|0,t[a]=this.oldData[i][a%h],t[a+1]=this.oldData[i][(a+1)%h],t[a+2]=this.oldData[i][(a+2)%h]})},r.fn.toMosaic=function(t,i){this.BaseFun(function(t){i=i||10;for(var a,r,s,o,e=this.width,f=this.height,u=t.length,c=0;c<e;c+=i)for(var g=0;g<f;g+=i){m=Math.floor(Math.random()*i),n=Math.floor(Math.random()*i),h=g+m>f-1?f-1:g+m,w=c+n>e-1?e-1:c+n,o=e*h*4+4*w,a=t[o],r=t[o+1],s=t[o+2];for(var l=0;l<i;l++)for(var d=0;d<i&&(o=e*(g+l)*4+4*(c+d),!(o>u));d++)t[o]=a,t[o+1]=r,t[o+2]=s}},t)},r.fn.ConBrBaseFilter=function(t,i,n){Array.isArray(t)||(n=i,i=t),this.BaseFun(function(t){if(i||n){for(var h,a=t.length,r=[0,0,0],s=this.width*this.height,o=4*this.width,e=0;e<a;e+=4)h=e/o|0,t[e]=this.oldData[h][e%o],t[e+1]=this.oldData[h][(e+1)%o],t[e+2]=this.oldData[h][(e+2)%o],r[0]+=t[e],r[1]+=t[e+1],r[2]+=t[e+2];r=r.map(function(t){return t/s|0});for(var e=0;e<a;e+=4)t[e]-=r[0],t[e+1]-=r[1],t[e+2]-=r[2],t[e]=t[e]*i|0,t[e+1]=t[e+1]*i|0,t[e+2]=t[e+2]*i|0,t[e]+=r[0]*n|0,t[e+1]+=r[1]*n|0,t[e+2]+=r[2]*n|0}})},r.fn.toMirror=function(t){this.BaseFun(function(t){for(var i,n,h,a,r,s,o=(t.length,this.width),e=o/2|0,f=this.height,u=0;u<f;u++){r=u*o*4;for(var c=0;c<e;c++)a=r+4*c,s=r+4*(o-1-c),i=t[a],n=t[a+1],h=t[a+2],t[a]=t[s],t[a+1]=t[s+1],t[a+2]=t[s+2],t[s]=i,t[s+1]=n,t[s+2]=h}},t)},r.fn.GaosiBulr=function(t){this.BaseFun(function(t){function i(t,i){for(var n=0,h=0,a=0,r=0,s=t.length;r<s;r++)for(var o=0;o<s;o++)n+=t[r][o]*i[r][o][0],h+=t[r][o]*i[r][o][1],a+=t[r][o]*i[r][o][2];return[0|n,0|h,0|a]}function n(t,i,n,h,a){a=a||this.imgData.data;for(var r,s,o,h=2*n+1,e=[],f=t-n,u=i-n,c=0;c<h;c++){e[c]=[];for(var g=0;g<h;g++)e[c][g]=[],s=c+f,o=g+u,s=s>=this.width?t:Math.abs(s),o=o>=this.height?i:Math.abs(o),r=4*s+4*o*this.width,e[c][g][0]=a[r],e[c][g][1]=a[r+1],e[c][g][2]=a[r+2]}return e}var h,r,s,o=3,e=2*o+1,f=[],u=this.width,c=this.height;a(f,o,e);for(var g=0;g<c;g++){h=g*u*4;for(var l=0;l<u;l++)r=h+4*l,s=i(f,n.call(this,l,g,o,e,t)),t[r]=s[0],t[r+1]=s[1],t[r+2]=s[2]}},t)},r.fn.toSketch=function(t){this.BaseFun(function(t){function i(t,i){var n=t+t*i/(256-i);return n=0|n,Math.min(255,n)}this.toGray(t);var n=t.slice();this.toInverse(n),this.GaosiBulr(n);for(var h=0;h<t.length;h+=4)t[h]=i(t[h],n[h]),t[h+1]=i(t[h+1],n[h+1]),t[h+2]=i(t[h+2],n[h+2])})},r.fn.BaseRoberts=function(t,n){for(var h,a,r,s,o,e,f=this.width,u=this.height,c=0;c<u;c++)for(var g,l,d,v,w,m,M,B,D,p=0;p<f;p++)h=4*(c*f+p),o=p+1,e=c+1,o=o<f?o:0,e=e<u?e:0,a=4*(c*f+o),r=4*(e*f+p),s=4*(e*f+o),g=t[h]-t[s],l=t[h+1]-t[s+1],d=t[h+2]-t[s+2],v=t[a]-t[r],m=t[a+1]-t[r+1],w=t[a+2]-t[r+2],M=Math.sqrt(g*g+v*v),D=Math.sqrt(l*l+m*m),B=Math.sqrt(d*d+w*w),t[h]=i(n(M,t[h])),t[h+1]=i(n(D,t[h+1])),t[h+2]=i(n(B,t[h+2]))},r.fn.Roberts=function(t){this.BaseFun(function(t){this.BaseRoberts(t,function(t,i){return t})},t)},r.fn.RobertsSharp=function(t){this.BaseFun(function(t){this.BaseRoberts(t,function(t,i){return t+i})},t)},t.I=t.LSGOImage=r}(this);
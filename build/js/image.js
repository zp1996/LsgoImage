"use strict";!function(t){function i(t){return t>255?255:t<0?0:t}var n=null,a=function t(i,n,a){return new t.fn.init(i,n,a)};a.fn=a.prototype,a.fn.init=function(t,i,n){var h=t.width||0,s=t.height||0;this.n=1,this.startX=0,this.startY=0,this.imgData=null,Object.defineProperties(this,{width:{get:function(){return h},set:function(i){t.width=h=i}},height:{get:function(){return s},set:function(i){t.height=s=i}}}),this.ctx=t.getContext("2d"),this.oldData=[],this.before=i||a.noop,this.after=n||a.noop},a.noop=function(){},a.setImg=function(t,i,n,h){this.startX=n||0,this.startY=h||0,this.width=this.startX+t.width,this.height=this.startX+t.height,this.ctx.drawImage(t,this.startX,this.startY,t.width,t.height),i=i||a.noop,this.getInfo(),i.call(this)},a.fn.init.prototype=a.fn,a.fn.setImg=function(t,i,n,h){if("string"==typeof t){var s=new Image,r=this;s.src=t,s.onload=function(){a.setImg.call(r,this,i,n,h)},s.onerror=function(){alert("图片路径有误！")}}else a.setImg.call(this,t,i,n,h);return this},a.fn.getInfo=function(t){this.imgData=this.ctx.getImageData(this.startX,this.startY,this.width-this.startX,this.height-this.startY),this.oldData=[];for(var i=0;i<this.height;i++){var n=i*this.width*4;this.oldData[i]=Array.prototype.slice.call(this.imgData.data,n,n+4*this.width)}return this},a.fn.changeImage=function(t){var i=this;this.imgData.data.forEach(function(n,a){i.imgData.data[a]=t[a]}),this.ctx.putImageData(this.imgData,0,0)},a.fn.matrixSlice=function(t){t=t||5,this.n=t;for(var i,n=this.imgData.data,a=n.length>>2,h=a/t|0,s={},r=0,o=0;o<a;o+=h)i=o+4*h,i=i<a?i:-1,s[r++]=Array.prototype.slice.call(n,o,o+4*h);return s},a.fn.BaseFun=function(t,i){return i=i||this.imgData.data,t.call(this,i),this.ctx.putImageData(this.imgData,0,0),this},a.fn.toGray=function(t){this.BaseFun(function(t){for(var i,n,a,h=t.length,s=0;s<h;s+=4)i=t[s],n=t[s+1],a=t[s+2],t[s]=t[s+1]=t[s+2]=(299*i+587*n+114*a)/1e3|0},t)},a.fn.toInverse=function(t){this.BaseFun(function(t){for(var i=t.length,n=0;n<i;n+=4)t[n]=255-t[n],t[n+1]=255-t[n+1],t[n+2]=255-t[n+2]},t)},a.fn.toOld=function(){this.BaseFun(function(t){for(var i,n=t.length,a=4*this.width,h=0;h<n;h+=4)i=h/a|0,t[h]=this.oldData[i][h%a],t[h+1]=this.oldData[i][(h+1)%a],t[h+2]=this.oldData[i][(h+2)%a]})},a.fn.toMosaic=function(t,i){this.BaseFun(function(t){i=i||10;for(var n,a,h,s,r,o,e,f,u=this.width,c=this.height,g=t.length,d=0;d<u;d+=i)for(var l=0;l<c;l+=i){r=Math.floor(Math.random()*i),o=Math.floor(Math.random()*i),e=l+r>c-1?c-1:l+r,f=d+o>u-1?u-1:d+o,s=u*e*4+4*f,n=t[s],a=t[s+1],h=t[s+2];for(var m=0;m<i;m++)for(var v=0;v<i&&(s=u*(l+m)*4+4*(d+v),!(s>g));v++)t[s]=n,t[s+1]=a,t[s+2]=h}},t)},a.fn.ConBrBaseFilter=function(t,i,n){Array.isArray(t)||(n=i,i=t),this.BaseFun(function(t){if(i||n){for(var a,h=t.length,s=[0,0,0],r=this.width*this.height,o=4*this.width,e=0;e<h;e+=4)a=e/o|0,t[e]=this.oldData[a][e%o],t[e+1]=this.oldData[a][(e+1)%o],t[e+2]=this.oldData[a][(e+2)%o],s[0]+=t[e],s[1]+=t[e+1],s[2]+=t[e+2];s=s.map(function(t){return t/r|0});for(var e=0;e<h;e+=4)t[e]-=s[0],t[e+1]-=s[1],t[e+2]-=s[2],t[e]=t[e]*i|0,t[e+1]=t[e+1]*i|0,t[e+2]=t[e+2]*i|0,t[e]+=s[0]*n|0,t[e+1]+=s[1]*n|0,t[e+2]+=s[2]*n|0}})},a.fn.toMirror=function(t){this.BaseFun(function(t){for(var i,n,a,h,s,r,o=(t.length,this.width),e=o/2|0,f=this.height,u=0;u<f;u++){s=u*o*4;for(var c=0;c<e;c++)h=s+4*c,r=s+4*(o-1-c),i=t[h],n=t[h+1],a=t[h+2],t[h]=t[r],t[h+1]=t[r+1],t[h+2]=t[r+2],t[r]=i,t[r+1]=n,t[r+2]=a}},t)},a.fn.GaosiBulr=function(t){var i=this;this.before(),t=t||this.imgData.data;var a=n||(n=new Worker("js/GaosiBulr.js"));a.onmessage=function(t){i.changeImage(t.data),i.after()},a.postMessage({arr:t,width:this.width,height:this.height})},a.fn.toSketch=function(){function t(t,i){var n=t+t*i/(256-i);return n=0|n,Math.min(255,n)}var i=this;this.before();var a=this.imgData.data;this.toGray(a);var h=n||(n=new Worker("js/GaosiBulr.js"));h.onmessage=function(n){i.toInverse(n.data);for(var h=0;h<a.length;h+=4)a[h]=t(a[h],n.data[h]),a[h+1]=t(a[h+1],n.data[h+1]),a[h+2]=t(a[h+2],n.data[h+2]);i.changeImage(a),i.after()},h.postMessage({arr:a,width:this.width,height:this.height})},a.fn.BaseRoberts=function(t,n){for(var a,h,s,r,o,e,f=this.width,u=this.height,c=0;c<u;c++)for(var g,d,l,m,v,w,D,p,B,I=0;I<f;I++)a=4*(c*f+I),o=I+1,e=c+1,o=o<f?o:0,e=e<u?e:0,h=4*(c*f+o),s=4*(e*f+I),r=4*(e*f+o),g=t[a]-t[r],d=t[a+1]-t[r+1],l=t[a+2]-t[r+2],m=t[h]-t[s],w=t[h+1]-t[s+1],v=t[h+2]-t[s+2],D=Math.sqrt(g*g+m*m),B=Math.sqrt(d*d+w*w),p=Math.sqrt(l*l+v*v),t[a]=i(n(D,t[a])),t[a+1]=i(n(B,t[a+1])),t[a+2]=i(n(p,t[a+2]))},a.fn.Roberts=function(t){this.BaseFun(function(t){this.BaseRoberts(t,function(t,i){return t})},t)},a.fn.RobertsSharp=function(t){this.BaseFun(function(t){this.BaseRoberts(t,function(t,i){return t+i})},t)},a.fn.toNostalgia=function(t){function i(){return.5*Math.random()+.5}function n(t,i,n){return t*i+(1-t)*n|0}this.BaseFun(function(t){for(var a=0,h=t.length;a<h;a+=4){var s=t[a],r=t[a+1],o=t[a+2];t[a]=n(i(),.393*s+.769*r+.189*o,s),t[a+1]=n(i(),.349*s+.686*r+.168*o,r),t[a+2]=n(i(),.272*s+.534*r+.131*o,o)}},t)},t.I=t.LSGOImage=a}(window);
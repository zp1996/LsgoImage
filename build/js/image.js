!function(t){function i(t,i,h){for(var n={},a=0,r=1.5,s=2*Math.pow(r,2),o=Math.PI*s,e=0;e<h;e++){t[e]=[];for(var f=Math.abs(i-e),u=0;u<h;u++){var c=Math.abs(i-u),g=f+c;t[e][u]=g in n?n[g]:n[g]=Math.exp(-(Math.pow(f,2)+Math.pow(c,2))/s)/o,a+=t[e][u]}}for(var e=0;e<h;e++)for(var u=0;u<h;u++)t[e][u]/=a}var a=function(t){return new a.fn.init(t)};a.fn=a.prototype,a.fn.init=function(t){var i=t.width||0,h=t.height||0;this.n=1,this.startX=0,this.startY=0,this.imgData=null,Object.defineProperties(this,{width:{get:function(){return i},set:function(h){t.width=i=h}},height:{get:function(){return h},set:function(i){t.height=h=i}}}),this.ctx=t.getContext("2d"),this.oldData=[]},a.noop=function(){},a.setImg=function(t,i,h,n){this.startX=h||0,this.startY=n||0,this.width=this.startX+t.width,this.height=this.startX+t.height,this.ctx.drawImage(t,this.startX,this.startY,t.width,t.height),i=i||a.noop,this.getInfo(),i.call(this)},a.fn.init.prototype=a.fn,a.fn.setImg=function(t,i,h,n){if("string"==typeof t){var r=new Image,s=this;r.src=t,r.onload=function(){a.setImg.call(s,this,i,h,n)},r.onerror=function(){alert("图片路径有误！")}}else a.setImg.call(this,t,i,h,n);return this},a.fn.getInfo=function(t){this.imgData=this.ctx.getImageData(this.startX,this.startY,this.width-this.startX,this.height-this.startY),this.oldData=[];for(var i=0;i<this.height;i++){var h=i*this.width*4;this.oldData[i]=this.imgData.data.slice(h,h+4*this.width)}return this},a.fn.matrixSlice=function(t){t=t||5,this.n=t;for(var i,h=this.imgData.data,n=h.length>>2,a=n/t|0,r={},s=0,o=0;o<n;o+=a)i=o+4*a,i=i<n?i:-1,r[s++]=Array.prototype.slice.call(h,o,o+4*a);return r},a.fn.BaseFun=function(t,i){return i=i||this.imgData.data,t.call(this,i),this.ctx.putImageData(this.imgData,0,0),this},a.fn.toGray=function(t){this.BaseFun(function(t){for(var i,h,n,a=t.length,r=0;r<a;r+=4)i=t[r],h=t[r+1],n=t[r+2],t[r]=t[r+1]=t[r+2]=(299*i+587*h+114*n)/1e3|0},t)},a.fn.toInverse=function(t){this.BaseFun(function(t){for(var i=t.length,h=0;h<i;h+=4)t[h]=255-t[h],t[h+1]=255-t[h+1],t[h+2]=255-t[h+2]},t)},a.fn.toOld=function(){this.BaseFun(function(t){for(var i,h=t.length,n=4*this.width,a=0;a<h;a+=4)i=a/n|0,t[a]=this.oldData[i][a%n],t[a+1]=this.oldData[i][(a+1)%n],t[a+2]=this.oldData[i][(a+2)%n]})},a.fn.toMosaic=function(t,i){this.BaseFun(function(t){i=i||10;for(var a,r,s,o,e=this.width,f=this.height,u=t.length,c=0;c<e;c+=i)for(var g=0;g<f;g+=i){m=Math.floor(Math.random()*i),n=Math.floor(Math.random()*i),h=g+m>f-1?f-1:g+m,w=c+n>e-1?e-1:c+n,o=e*h*4+4*w,a=t[o],r=t[o+1],s=t[o+2];for(var l=0;l<i;l++)for(var d=0;d<i&&(o=e*(g+l)*4+4*(c+d),!(o>u));d++)t[o]=a,t[o+1]=r,t[o+2]=s}},t)},a.fn.ConBrBaseFilter=function(t,i,h){Array.isArray(t)||(h=i,i=t),this.BaseFun(function(t){if(i||h){for(var n,a=t.length,r=[0,0,0],s=this.width*this.height,o=4*this.width,e=0;e<a;e+=4)n=e/o|0,t[e]=this.oldData[n][e%o],t[e+1]=this.oldData[n][(e+1)%o],t[e+2]=this.oldData[n][(e+2)%o],r[0]+=t[e],r[1]+=t[e+1],r[2]+=t[e+2];r=r.map(function(t){return t/s|0});for(var e=0;e<a;e+=4)t[e]-=r[0],t[e+1]-=r[1],t[e+2]-=r[2],t[e]=t[e]*i|0,t[e+1]=t[e+1]*i|0,t[e+2]=t[e+2]*i|0,t[e]+=r[0]*h|0,t[e+1]+=r[1]*h|0,t[e+2]+=r[2]*h|0}})},a.fn.toMirror=function(t){this.BaseFun(function(t){for(var i,h,n,a,r,s,o=(t.length,this.width),e=o/2|0,f=this.height,u=0;u<f;u++){r=u*o*4;for(var c=0;c<e;c++)a=r+4*c,s=r+4*(o-1-c),i=t[a],h=t[a+1],n=t[a+2],t[a]=t[s],t[a+1]=t[s+1],t[a+2]=t[s+2],t[s]=i,t[s+1]=h,t[s+2]=n}},t)},a.fn.GaosiBulr=function(t){this.BaseFun(function(t){function h(t,i){for(var h=0,n=0,a=0,r=0,s=t.length;r<s;r++)for(var o=0;o<s;o++)h+=t[r][o]*i[r][o][0],n+=t[r][o]*i[r][o][1],a+=t[r][o]*i[r][o][2];return[0|h,0|n,0|a]}function n(t,i,h,n,a){a=a||this.imgData.data;for(var r,s,o,n=2*h+1,e=[],f=t-h,u=i-h,c=0;c<n;c++){e[c]=[];for(var g=0;g<n;g++)e[c][g]=[],s=c+f,o=g+u,s=s>=this.width?t:Math.abs(s),o=o>=this.height?i:Math.abs(o),r=4*s+4*o*this.width,e[c][g][0]=a[r],e[c][g][1]=a[r+1],e[c][g][2]=a[r+2]}return e}var a,r,s,o=3,e=2*o+1,f=[],u=this.width,c=this.height;i(f,o,e);for(var g=0;g<c;g++){a=g*u*4;for(var l=0;l<u;l++)r=a+4*l,s=h(f,n.call(this,l,g,o,e,t)),t[r]=s[0],t[r+1]=s[1],t[r+2]=s[2]}},t)},a.fn.toSketch=function(t){this.BaseFun(function(t){function i(t,i){var h=t+t*i/(256-i);return h=0|h,Math.min(255,h)}this.toGray(t);var h=t.slice();this.toInverse(h),this.GaosiBulr(h);for(var n=0;n<t.length;n+=4)t[n]=i(t[n],h[n]),t[n+1]=i(t[n+1],h[n+1]),t[n+2]=i(t[n+2],h[n+2])})},t.I=t.LSGOImage=a}(this);